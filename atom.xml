<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>GANG</title>
  
  <subtitle>爱耍剑的程序猿一枚</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-05-24T05:08:15.443Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>GANG</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Spring Boot Feign</title>
    <link href="http://yoursite.com/2019/05/24/Spring-Boot-Feign/"/>
    <id>http://yoursite.com/2019/05/24/Spring-Boot-Feign/</id>
    <published>2019-05-24T03:17:47.000Z</published>
    <updated>2019-05-24T05:08:15.443Z</updated>
    
    <content type="html"><![CDATA[<p>在Spring Boot项目实际开发中，需要把有些独立的功能分离出来作为单独的服务，比如第三方的调用、用户信息等等，这个时候就需要来做服务间的调用，目前项目中使用<strong>consul</strong>作为实现分布式系统的服务发现与配置。</p><hr><h1 id="调用方"><a href="#调用方" class="headerlink" title="调用方"></a>调用方</h1><p>在实际项目中，会使用单独的接口来调用其他服务，需要在接口上使用<code>@FeignClient</code>注解,<code>name</code>属性指定了该feign client对应的微服务service名称，并且框架将通过<code>name</code>属性自动将feign client解析到对应的服务器地址上。</p><h2 id="使用过程"><a href="#使用过程" class="headerlink" title="使用过程"></a>使用过程</h2><h3 id="引入依赖包"><a href="#引入依赖包" class="headerlink" title="引入依赖包"></a>引入依赖包</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-feign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="启动类"><a href="#启动类" class="headerlink" title="启动类"></a>启动类</h3><p>启动类需要加<code>@EnableFeignClients</code>注解<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">**</span><br><span class="line"> * 启动入口</span><br><span class="line"> */</span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"all"</span>)</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages=&#123;<span class="string">"cn.net.xxx.wechat.bapi"</span>,<span class="string">"cn.net.xxx.wechat.common"</span>&#125;)</span><br><span class="line"><span class="meta">@Import</span>(&#123; SwaggerConfig.class, DataSourceConfig.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Application.start(BaseApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="撸代码"><a href="#撸代码" class="headerlink" title="撸代码"></a>撸代码</h3><p><code>wechat-user</code>这里是我们在<code>consul</code>上注册的服务地址。<br><code>/user/sso/queryUserByToken</code> 表示服务方完整调用路径。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 调用用户模块服务</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2018/11/28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@FeignClient</span>(name = <span class="string">"wechat-user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"/user/sso/queryUserByToken"</span>)</span><br><span class="line">    <span class="function">DataResult&lt;UserInfo&gt; <span class="title">queryUserByToken</span><span class="params">(@RequestParam(<span class="string">"token"</span>)</span> String token)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="服务提供方"><a href="#服务提供方" class="headerlink" title="服务提供方"></a>服务提供方</h1><h3 id="引入依赖包-1"><a href="#引入依赖包-1" class="headerlink" title="引入依赖包"></a>引入依赖包</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-feign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="启动类-1"><a href="#启动类-1" class="headerlink" title="启动类"></a>启动类</h3><p>启动类需要加<code>@EnableFeignClients</code>和<code>@EnableDiscoveryClient</code>注解<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动入口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"all"</span>)</span><br><span class="line"><span class="meta">@EnableSwagger</span>2</span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@HJundertow</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages=&#123;<span class="string">"cn.net.xxx.wechat.user"</span>,<span class="string">"cn.net.xxx.wechat.common.cache.redis"</span>&#125;)</span><br><span class="line"><span class="meta">@Import</span>(&#123;SwaggerConfig.class, DataSourceConfig.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 程序入口</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args 参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> </span>&#123;</span><br><span class="line">        Application.start(UserApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="撸代码-1"><a href="#撸代码-1" class="headerlink" title="撸代码"></a>撸代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 用户登录</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2018/11/26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@CrossOrigin</span>(value = <span class="string">"*"</span>, maxAge = <span class="number">3600</span>)</span><br><span class="line"><span class="meta">@Api</span>(value = <span class="string">"用户登录"</span>, tags = <span class="string">"用户登录"</span>)</span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/sso"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据token获取用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/queryUserByToken"</span>)</span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"queryUserByToken"</span>, httpMethod = <span class="string">"GET"</span>, response = DataResult.class, notes = <span class="string">"用户登录"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataResult&lt;UserInfo&gt; <span class="title">queryUserByToken</span><span class="params">(@RequestParam(<span class="string">"token"</span>)</span> String token)</span>&#123;</span><br><span class="line">        UserInfo user = <span class="keyword">this</span>.userServiceImpl.queryUserByToken(token);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> == user)&#123;</span><br><span class="line">            <span class="keyword">return</span> DataResult.fail(REP_10003.getCode(), REP_10003.getMsg());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> DataResult.ok(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="consul服务注册配置"><a href="#consul服务注册配置" class="headerlink" title="consul服务注册配置"></a>consul服务注册配置</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.consul</span><span class="selector-class">.host</span>=<span class="number">192.168</span>.<span class="number">205.196</span></span><br><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.consul</span><span class="selector-class">.port</span>=<span class="number">8506</span></span><br><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.consul</span><span class="selector-class">.discovery</span><span class="selector-class">.health-check-path</span>=$&#123;server.context-path&#125;/health</span><br><span class="line"></span><br><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.consul</span><span class="selector-class">.discovery</span><span class="selector-class">.hostname</span>=<span class="number">192.168</span>.<span class="number">207.18</span></span><br><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.consul</span><span class="selector-class">.discovery</span><span class="selector-class">.port</span>=$&#123;server.port&#125;</span><br><span class="line"></span><br><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.consul</span><span class="selector-class">.discovery</span><span class="selector-class">.service-name</span>=$&#123;spring<span class="selector-class">.application</span><span class="selector-class">.name</span>&#125;</span><br><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.consul</span><span class="selector-class">.discovery</span><span class="selector-class">.enabled</span>=true</span><br><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.consul</span><span class="selector-class">.discovery</span><span class="selector-class">.instance-id</span>=$&#123;spring<span class="selector-class">.cloud</span><span class="selector-class">.consul</span><span class="selector-class">.discovery</span><span class="selector-class">.service-name</span>&#125;:$&#123;spring<span class="selector-class">.cloud</span><span class="selector-class">.consul</span><span class="selector-class">.discovery</span><span class="selector-class">.hostname</span>&#125;:$&#123;server.port&#125;</span><br><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.consul</span><span class="selector-class">.discovery</span><span class="selector-class">.health-check-interval</span>=<span class="number">10s</span></span><br><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.consul</span><span class="selector-class">.enabled</span>=true</span><br><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.consul</span><span class="selector-class">.discovery</span><span class="selector-class">.register</span>=true</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在Spring Boot项目实际开发中，需要把有些独立的功能分离出来作为单独的服务，比如第三方的调用、用户信息等等，这个时候就需要来做服务间的调用，目前项目中使用&lt;strong&gt;consul&lt;/strong&gt;作为实现分布式系统的服务发现与配置。&lt;/p&gt;
&lt;hr&gt;
&lt;h1 i
      
    
    </summary>
    
    
      <category term="Spring Boot" scheme="http://yoursite.com/tags/Spring-Boot/"/>
    
  </entry>
  
  <entry>
    <title>Docker 清理日志</title>
    <link href="http://yoursite.com/2019/05/23/Docker%20%E6%B8%85%E7%90%86%E6%97%A5%E5%BF%97/"/>
    <id>http://yoursite.com/2019/05/23/Docker 清理日志/</id>
    <published>2019-05-23T12:52:22.000Z</published>
    <updated>2019-05-24T02:17:32.939Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker-日志位置"><a href="#Docker-日志位置" class="headerlink" title="Docker 日志位置"></a>Docker 日志位置</h1><p>docker 日志存放位置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/lib/docker/containers</span><br></pre></td></tr></table></figure><h1 id="查看Docker日志大小"><a href="#查看Docker日志大小" class="headerlink" title="查看Docker日志大小"></a>查看Docker日志大小</h1><p>查看docker各个容器日志大小<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -lh $(find /var/lib/docker/containers/ -name *-json.log)</span><br></pre></td></tr></table></figure></p><h1 id="清除日志"><a href="#清除日志" class="headerlink" title="##清除日志"></a>##清除日志</h1><p>清空日志<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /dev/null &gt;/var/lib/docker/containers/containerid/containerid.log-json.log</span><br></pre></td></tr></table></figure></p><p>可以直接复制上一步的日志文件路径，比如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /dev/null &gt; /var/lib/docker/containers/f2a458838cc30d15396cc7ec1b3b46662140bf3cba0b12b010baf6190f61f744/f2a458838cc30d15396cc7ec1b3b46662140bf3cba0b12b010baf6190f61f744-json.log</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Docker-日志位置&quot;&gt;&lt;a href=&quot;#Docker-日志位置&quot; class=&quot;headerlink&quot; title=&quot;Docker 日志位置&quot;&gt;&lt;/a&gt;Docker 日志位置&lt;/h1&gt;&lt;p&gt;docker 日志存放位置&lt;/p&gt;
&lt;figure class=&quot;h
      
    
    </summary>
    
    
      <category term="Docker" scheme="http://yoursite.com/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker </title>
    <link href="http://yoursite.com/2019/05/23/Docker/"/>
    <id>http://yoursite.com/2019/05/23/Docker/</id>
    <published>2019-05-23T07:39:56.000Z</published>
    <updated>2019-05-23T07:41:46.406Z</updated>
    
    <content type="html"><![CDATA[<p>#这是第一篇文章</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;#这是第一篇文章&lt;/p&gt;

      
    
    </summary>
    
    
      <category term="Docker" scheme="http://yoursite.com/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://yoursite.com/2019/05/22/hello-world/"/>
    <id>http://yoursite.com/2019/05/22/hello-world/</id>
    <published>2019-05-22T07:58:11.004Z</published>
    <updated>2019-05-22T07:58:11.004Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
      
    
    </summary>
    
    
  </entry>
  
</feed>
